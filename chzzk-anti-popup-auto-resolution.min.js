// ==UserScript==
// @name         치지직 광고 팝업 차단 및 해상도 자동 설정
// @namespace    https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @homepageURL  https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @supportURL   https://github.com/Tsuring/chzzk-anti-popup-auto-resolution/issues
// @updateURL    https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @downloadURL  https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @version      1.0
// @description  치지직 광고 팝업 제거 + 자동 해상도 설정 (1080p 또는 720p)
// @author       Tsuring
// @match        https://chzzk.naver.com/*
// @grant        none
// @run-at       document-idle
// ==/UserScript==

!function(){"use strict";function e(){let e=document.querySelectorAll('div[class*="popup"], div[class*="modal"]');e.forEach(e=>{e.textContent.includes("광고 차단")&&(e.remove(),console.log("\uD83D\uDEAB 광고 차단 팝업 제거됨"))})}async function t(e=10,t=1e3){try{let l=await function e(t,l=5e3){return new Promise((e,n)=>{let c=0,i=()=>{let r=document.querySelector(t);r?e(r):c>=l?n(Error(`❌ 요소 찾기 실패: ${t}`)):(c+=100,setTimeout(i,100))};i()})}(".pzp-pc-setting-button",5e3);l.click(),console.log("⚙️ 설정 버튼 클릭됨");let n=async(l=1)=>{let c=document.querySelector(".pzp-pc-setting-intro-quality");if(c){c.click(),console.log(`📺 화질 메뉴 클릭 (시도 ${l}/${e})`);let i=document.querySelectorAll('li[role="menuitem"]'),r=Array.from(i).find(e=>e.textContent.includes("1080p")),o=e=>e.classList.contains("pzp-ui-setting-pane-item--checked");if(r&&!o(r)){!function e(t){t.focus();let l=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:"Enter",code:"Enter",keyCode:13,which:13});t.dispatchEvent(l)}(r),console.log("✅ 1080p 선택 성공");return}if(r&&o(r)){console.log("ℹ️ 이미 1080p 선택되어 있음");return}}l<e?setTimeout(()=>n(l+1),t):console.warn("⛔ 해상도 선택 실패 - 최대 시도 초과")};setTimeout(()=>n(),500)}catch(c){console.error(c.message)}}let l=new MutationObserver(e);l.observe(document.body,{childList:!0,subtree:!0}),e(),location.href.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDFE2 처음부터 live 페이지입니다. 해상도 설정 시도 중..."),setTimeout(()=>{t()},1e3));let n=location.href;setInterval(()=>{let e=location.href;e!==n&&(n=e,e.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDD04 live 페이지로 이동 감지됨. 해상도 설정 시도 중..."),setTimeout(()=>{t()},500)))},500),window.debugChzzk={observer:l,removeAdBlockPopup:e,setResolution:t}}();
