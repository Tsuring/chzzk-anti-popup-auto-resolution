// ==UserScript==
// @name         치지직 광고 팝업 차단 및 해상도 자동 설정
// @namespace    https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @homepageURL  https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @supportURL   https://github.com/Tsuring/chzzk-anti-popup-auto-resolution/issues
// @updateURL    https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @downloadURL  https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @version      1.0
// @description  치지직 광고 팝업 제거 + 자동 해상도 설정 (1080p 또는 720p)
// @author       Tsuring
// @match        https://chzzk.naver.com/*
// @grant        none
// @run-at       document-idle
// ==/UserScript==

!function(){"use strict";function e(){let e=document.querySelectorAll('div[class*="popup"], div[class*="modal"]');e.forEach(e=>{e.textContent.includes("광고 차단")&&(e.remove(),console.log("\uD83D\uDEAB 광고 차단 팝업 제거됨"))})}function t(e,t=5e3){return new Promise((l,n)=>{let c=0,o=()=>{let i=document.querySelector(e);i?l(i):c>=t?n(Error(`❌ 요소 찾기 실패: ${e}`)):(c+=100,setTimeout(o,100))};o()})}async function l(){function e(e){e.focus();let t=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:"Enter",code:"Enter",keyCode:13,which:13});e.dispatchEvent(t)}try{let l=await t(".pzp-pc-setting-button");l.click(),console.log("⚙️ 설정 버튼 클릭됨");let n=await t(".pzp-pc-setting-intro-quality");n.click(),console.log("\uD83D\uDCFA 화질 메뉴 클릭됨");let c=document.querySelectorAll('li[role="menuitem"]'),o=Array.from(c).find(e=>e.textContent.includes("1080p")),i=Array.from(c).find(e=>e.textContent.includes("720p")),r=e=>e.classList.contains("pzp-ui-setting-pane-item--checked");o&&!r(o)?(e(o),console.log("✅ 1080p 선택됨")):i&&!r(i)?(e(i),console.log("✅ 720p 선택됨")):console.log("ℹ️ 이미 선택되어 있거나 해상도 옵션 없음")}catch(s){console.error(s.message)}}let n=new MutationObserver(e);n.observe(document.body,{childList:!0,subtree:!0}),e(),location.href.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDFE2 처음부터 live 페이지입니다. 해상도 설정 시도 중..."),setTimeout(()=>{l()},1e3));let c=location.href;setInterval(()=>{let e=location.href;e!==c&&(c=e,e.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDD04 live 페이지로 이동 감지됨. 해상도 설정 시도 중..."),setTimeout(()=>{l()},500)))},500),window.debugChzzk={observer:n,removeAdBlockPopup:e,setResolution:l}}();
