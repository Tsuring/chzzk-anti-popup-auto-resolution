// ==UserScript==
// @name         ì¹˜ì§€ì§ ê´‘ê³  íŒì—… ì°¨ë‹¨ ë° í•´ìƒë„ ìë™ ì„¤ì •
// @namespace    https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @homepageURL  https://github.com/Tsuring/chzzk-anti-popup-auto-resolution
// @supportURL   https://github.com/Tsuring/chzzk-anti-popup-auto-resolution/issues
// @updateURL    https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @downloadURL  https://cdn.jsdelivr.net/gh/tsuring/chzzk-anti-popup-auto-resolution@latest/chzzk-anti-popup-auto-resolution.min.js
// @version      1.0
// @description  ì¹˜ì§€ì§ ê´‘ê³  íŒì—… ì œê±° + ìë™ í•´ìƒë„ ì„¤ì • (1080p ë˜ëŠ” 720p)
// @author       Tsuring
// @match        https://chzzk.naver.com/*
// @grant        none
// @run-at       document-idle
// ==/UserScript==

!function(){"use strict";function e(){let e=document.querySelectorAll('div[class*="popup"], div[class*="modal"]');e.forEach(e=>{e.textContent.includes("ê´‘ê³  ì°¨ë‹¨")&&(e.remove(),console.log("\uD83D\uDEAB ê´‘ê³  ì°¨ë‹¨ íŒì—… ì œê±°ë¨"))})}async function t(e=10,t=1e3){try{let l=await function e(t,l=5e3){return new Promise((e,n)=>{let c=0,i=()=>{let r=document.querySelector(t);r?e(r):c>=l?n(Error(`âŒ ìš”ì†Œ ì°¾ê¸° ì‹¤íŒ¨: ${t}`)):(c+=100,setTimeout(i,100))};i()})}(".pzp-pc-setting-button",5e3);l.click(),console.log("âš™ï¸ ì„¤ì • ë²„íŠ¼ í´ë¦­ë¨");let n=async(l=1)=>{let c=document.querySelector(".pzp-pc-setting-intro-quality");if(c){c.click(),console.log(`ğŸ“º í™”ì§ˆ ë©”ë‰´ í´ë¦­ (ì‹œë„ ${l}/${e})`);let i=document.querySelectorAll('li[role="menuitem"]'),r=Array.from(i).find(e=>e.textContent.includes("1080p")),o=e=>e.classList.contains("pzp-ui-setting-pane-item--checked");if(r&&!o(r)){!function e(t){t.focus();let l=new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,key:"Enter",code:"Enter",keyCode:13,which:13});t.dispatchEvent(l)}(r),console.log("âœ… 1080p ì„ íƒ ì„±ê³µ");return}if(r&&o(r)){console.log("â„¹ï¸ ì´ë¯¸ 1080p ì„ íƒë˜ì–´ ìˆìŒ");return}}l<e?setTimeout(()=>n(l+1),t):console.warn("â›” í•´ìƒë„ ì„ íƒ ì‹¤íŒ¨ - ìµœëŒ€ ì‹œë„ ì´ˆê³¼")};setTimeout(()=>n(),500)}catch(c){console.error(c.message)}}let l=new MutationObserver(e);l.observe(document.body,{childList:!0,subtree:!0}),e(),location.href.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDFE2 ì²˜ìŒë¶€í„° live í˜ì´ì§€ì…ë‹ˆë‹¤. í•´ìƒë„ ì„¤ì • ì‹œë„ ì¤‘..."),setTimeout(()=>{t()},1e3));let n=location.href;setInterval(()=>{let e=location.href;e!==n&&(n=e,e.startsWith("https://chzzk.naver.com/live/")&&(console.log("\uD83D\uDD04 live í˜ì´ì§€ë¡œ ì´ë™ ê°ì§€ë¨. í•´ìƒë„ ì„¤ì • ì‹œë„ ì¤‘..."),setTimeout(()=>{t()},500)))},500),window.debugChzzk={observer:l,removeAdBlockPopup:e,setResolution:t}}();
